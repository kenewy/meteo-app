title:"meteo"
---



```{python}

import requests
from datetime import datetime , timedelta
import json
from statistics import mean
from PIL import Image, ImageDraw, ImageFont, ImageColor
import matplotlib.pyplot as plt
import numpy as np

def dataclean(dataliste):
    for i in range(len(dataliste)):
        if(dataliste[i]==None):
            dataliste[i]=dataliste[i-1]
    return dataliste


presentday=datetime.today()
start_date=presentday.strftime("%Y-%m-%d")
end_date = presentday + timedelta(4)
end_date=end_date.strftime("%Y-%m-%d")
j=[]
nj=[]
j.append(presentday)
nj.append(j[0].strftime("%A"))
for i in range(4):
  j.append(presentday + timedelta(i+1))
  nj.append(j[i+1].strftime("%A"))
print(nj)

n_start_date=presentday.strftime("%A")


print(start_date)
print(end_date)
url="https://api.open-meteo.com/v1/meteofrance?latitude=43.61&longitude=3.87&hourly=cloud_cover&hourly=relativehumidity_2m&hourly=precipitation&hourly=temperature_2m&hourly=windspeed_10m&start_date="+start_date+"&end_date="+end_date
response=requests.get(url).content.decode('utf-8')
data = json.loads(response)
temperatureliste=data["hourly"]["temperature_2m"]
windsliste=data["hourly"]["windspeed_10m"]
precipitationliste=data["hourly"]["precipitation"]
relativehumidity=data["hourly"]["temperature_2m"]
cloud_cover=data["hourly"]["cloud_cover"]


temperatureliste=dataclean(temperatureliste)
windsliste=dataclean(windsliste)
precipitationliste=dataclean(precipitationliste)
relativehumidity=dataclean(relativehumidity)
cloud_cover=dataclean(cloud_cover)


maxtemp=[0,0,0,0,0]
mintemp=[0,0,0,0,0]
winds=[0,0,0,0,0]
precipitation=[0,0,0,0,0]
maxhumi=[0,0,0,0,0]
cloudj=[0,0,0,0,0]

for i in range(len(maxtemp)):
  maxtemp[i]=max(temperatureliste[24*i:24*(i+1)-1])
  mintemp[i]=min(temperatureliste[24*i:24*(i+1)-1])
  winds[i]=mean(windsliste[24*i:24*(i+1)-1])
  precipitation[i]=sum(precipitationliste[24*i +6:24*(i+1)-1 -6])
  maxhumi[0]=max(relativehumidity[24*i:24*(i+1)-1])
  cloudj[0]=mean(cloud_cover[24*i +6:24*(i+1)-1 -6])
print(mintemp)
print(maxtemp)
print(winds)
print(precipitation)
print(maxhumi)

precipitationn=[0,0,0,0]
cloudn=[0,0,0,0]
for i in range(len(cloudn)):
  cloudn[i]=mean(cloud_cover[18+24*i:18+12+24*i])
  precipitationn[i]=sum(precipitationliste[18+24*i:18+12+24*i])

C=70
L=310
img = Image.open("meteoback.jpg")
img_cloud=Image.open("cloud_p.jpg")
img_cloud2=Image.open("cloud2.jpg")
img_cloud3=Image.open("cloud3.jpg")
img_sun=Image.open("sun.jpg")

img_hum=Image.open("hum.jpg")
img_pres_nuit=Image.open("pluit_nuit.jpg")
img_croissant=Image.open("croissant.jpg")
img_cr_nua=Image.open("cr_nua.jpg")
img_nua_nuit=Image.open("nua_nuit.jpg")

draw = ImageDraw.Draw(img)

font = ImageFont.truetype("Gidole-Regular.ttf", size=50)
font1 = ImageFont.truetype("Gidole-Regular.ttf", size=30)
font2 = ImageFont.truetype("Gidole-Regular.ttf", size=20)
font3 = ImageFont.truetype("Gidole-Regular.ttf", size=34)


draw.text((C+20, 120), nj[0],font=font3, fill='black')
for i in range(len(nj)-1):
    draw.text((C+20+170*(i+1), 140), nj[i+1],font=font1, fill='black')


for i  in range(len(maxtemp)):
  draw.text((C+170*i, L), str(round(maxtemp[i],2))+"°C",font=font, fill='black')
  draw.text((C+10+170*i, L+50), str(round(mintemp[i],2))+"°C",font=font1, fill='black')
  draw.text((C+170*i, L+100), str(round(maxhumi[i],2))+"%",font=font1, fill='black')
  draw.text((C+10+170*i, L+140), str(round(precipitation[i], 2))+"mm",font=font1, fill='black')
  draw.text((C+10+170*i, L+180), str(round(winds[i], 2))+"Km/h",font=font2, fill='black')
  img.paste(img_hum.resize((30, 30)),(C+90+170*i, L+100),)
  if(precipitation[i]>2):
    img.paste(img_cloud.resize((100, 100)),(C+20+170*i, 190),)
  elif (25>cloudj[i]):
    img.paste(img_sun.resize((100, 100)),(C+20+170*i, 190),)
  elif (60>cloudj[i]):
    img.paste(img_cloud2.resize((100, 100)),(C+20+170*i, 190),)
  else:
    img.paste(img_cloud3.resize((100, 100)),(C+20+170*i, 190),)
for i in range(len(cloudn)):
  if(precipitationn[i]>2):
    img.paste(img_pres_nuit.resize((50, 50)),(C+125+170*i, 250),)
  elif (25>cloudn[i]):
    img.paste(img_croissant.resize((50, 50)),(C+125+170*i, 250),)
  elif (60>cloudn[i]):
    img.paste(img_cr_nua.resize((50, 50)),(C+125+170*i, 250),)
  else:
    img.paste(img_nua_nuit.resize((50, 50)),(C+125+170*i, 250),)
plt.axis("off")
plt.imshow(img)
```
from IPython.display import HTML

# Votre code Python ici pour extraire les données météorologiques...
html_code = f"""
<head>
    <link rel="stylesheet" href="styles.css">
</head>

<table id="myTable">
    <!-- Ligne 1 -->
    <tr title="Date" style="background-color: rgb(180, 255, 255)">
        <th style="background-color: rgb(255, 255, 255); border-top:3px solid rgb(20, 15, 185); border-right:3px solid rgb(20, 15, 185); border-left:3px solid rgb(20, 15, 185)">
            <strong> {noms_jours[0]} </strong>
            <br>Aujourd'hui
        </th>
        <th>
            <strong> {noms_jours[1]} </strong>
            <br>Demain
        </th>
        <th>
            <strong> {noms_jours[2]} </strong>
            <br>{dates_formatees[2]}
        </th>
        <th>
            <strong> {noms_jours[3]} </strong>
            <br>{dates_formatees[3]}
        </th>
        <th>
            <strong> {noms_jours[4]} </strong>
            <br>{dates_formatees[4]}
        </th>
    </tr>

    <!-- Ligne 2 -->
    <tr title="icône WMO" style="background-color: rgb(82, 177, 255)">
        <th style="border-right:3px solid rgb(20, 15, 185); border-left:3px solid rgb(20, 15, 185)">
            <img class="day-image" src ="{noms_urls[0]['url']}" title="{noms_urls[0]['nom']}">
            <img class="circular-image" src ="{noms_urls_n[0]['urln']}" title="{noms_urls_n[0]['nom']}">
        </th>
        <th>
            <img class="day-image" src ="{noms_urls[1]['url']}" title="{noms_urls[1]['nom']}">
            <img class="circular-image" src ="{noms_urls_n[1]['urln']}" title="{noms_urls_n[1]['nom']}">
        </th>
        <th>
            <img class="day-image" src ="{noms_urls[2]['url']}" title="{noms_urls[2]['nom']}">
            <img class="circular-image" src ="{noms_urls_n[2]['urln']}" title="{noms_urls_n[2]['nom']}">
        </th>
        <th>
            <img class="day-image" src ="{noms_urls[3]['url']}" title="{noms_urls[3]['nom']}">
            <img class="circular-image" src ="{noms_urls_n[3]['urln']}" title="{noms_urls_n[3]['nom']}">
        </th>
        <th>
            <img src ="{noms_urls[4]['url']}" title="{noms_urls[4]['nom']}" style="width:60px; height:60px">
        </th>
    </tr>

    <!-- Ligne 3 -->
    <tr title="Températures minimale - maximale" style="background-color: rgb(180, 255, 255)">
        <th style="background-color: rgb(255, 255, 255); border-right:3px solid rgb(20, 15, 185); border-left:3px solid rgb(20, 15, 185)">
            {generate_temperature(temperature_min_ent[0], temperature_max_ent[0], moyenne[0])}
        </th>
        <th>
            {generate_temperature(temperature_min_ent[1], temperature_max_ent[1], moyenne[1])}
        </th>
        <th>
            {generate_temperature(temperature_min_ent[2], temperature_max_ent[2], moyenne[2])}
        </th>
        <th>
            {generate_temperature(temperature_min_ent[3], temperature_max_ent[3], moyenne[3])}
        </th>
        <th>
            {generate_temperature(temperature_min_ent[4], temperature_max_ent[4], moyenne[4])}
        </th>
    </tr>

    <!-- Ligne 4 -->
    <tr title="Vitesse moyenne du vent" style="background-color: rgb(180, 255, 255)">
        <th style="background-color: rgb(255, 255, 255); border-right:3px solid rgb(20, 15, 185); border-left:3px solid rgb(20, 15, 185)">
            {generate_wind(vent[0], direction_vent[0])}
        </th>
        <th>
            {generate_wind(vent[1], direction_vent[1])}
        </th>
        <th>
            {generate_wind(vent[2], direction_vent[2])}
        </th>
        <th>
            {generate_wind(vent[3], direction_vent[3])}
        </th>
        <th>
            {generate_wind(vent[4], direction_vent[4])}
        </th>
    </tr>
    
    <!-- Ligne 5 -->
    <tr title="Quantité de précipitations" style="background-color: rgb(180, 255, 255)">
        <th style="background-color: rgb(255, 255, 255); border-bottom:3px solid rgb(20, 15, 185); border-right:3px solid rgb(20, 15, 185); border-left:3px solid rgb(20, 15, 185)">
            <img src="images_svg/Water_Drop.svg"> {precipitations[0]} mm
        </th>
        <th>
            <img src="images_svg/Water_Drop.svg"> {precipitations[1]} mm
        </th>
        <th>
            <img src="images_svg/Water_Drop.svg"> {precipitations[2]} mm
        </th>
        <th>
            <img src="images_svg/Water_Drop.svg"> {precipitations[3]} mm
        </th>
        <th>
            <img src="images_svg/Water_Drop.svg"> {precipitations[4]} mm
        </th>
    </tr>
</table>
"""

display(HTML(html_code))
